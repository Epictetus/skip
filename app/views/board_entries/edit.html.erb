<%= render :partial => 'board_entries/preview_window' %>

<% form_for [current_tenant, current_target_owner, @board_entry], :html => {:class => 'board_entry_form'} do |f| -%>
  <%= render f %>
  <% if @conflicted -%>
    <div class="desc ui-corner-all"><%= _("*Click on &quot;Reset&quot; to reset the edit or &quot;Update&quot; to overwrite other's edit.")%></div>
    <%= button_to_function(_("Reset"), "if(confirm('" + _('All changes will be discarded. Are you sure to proceed?') + "')){window.location.href='#{edit_polymorphic_url([current_tenant, current_target_owner, @board_entry])}' }") %>
  <% end -%>
  <div class="publication_status_wrapper">選択されている公開範囲<span id="publication_status"></span></div>
  <%= submit_tag _("Update"), :id => 'submit_button' %>
  <%= send_mail_check_box_tag %>
<% end -%>
<%= render :partial => 'board_entries/embed_dialog', :locals => {:board_entry => @board_entry} %>

<div class="desc ui-corner-all" style="margin-top: 10px;">
  <% form_for [current_tenant, current_target_owner, @board_entry], :html => {:method => :delete, :onsubmit => 'return confirmDestroy(event)'} do |f| -%>
    <%= submit_tag _('Delete') %>
  <% end -%>
</div>

<% content_for :javascript_initializers do -%>
  <%# beforeunloadイベントをキャンセルするため、railsのconfirmを使わず独自実装 %>
  <%# jQueryのclickイベントで設定するとbeforeunloadの方が先に呼ばれてしまい、うまくいかないのでonclickを利用 %>
  confirmDestroy = function(e) {
    if (confirm('<%= _("Are you sure to delete?")%>')) {
      $j(window).unbind('beforeunload');
      return true;
    } else {
      return false;
    }
  }
<% end -%>
