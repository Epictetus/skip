<%
  # FIXME 要リファクタ
  select_state = "count(distinct board_entries.id) as count, users.name as user_name, users.id as user_id"
  joins_state = "LEFT OUTER JOIN entry_publications ON entry_publications.board_entry_id = board_entries.id"
  joins_state << " LEFT OUTER JOIN users ON users.id = board_entries.user_id"
  user_archives = BoardEntry.accessible(current_user).find(:all,
                                                           :select => select_state,
                                                           :group => "user_id",
                                                           :order => "count desc",
                                                           :joins => joins_state)
-%>

<div class="box_space">
  <div class="box_space_title"><%= icon_tag 'user_comment' %><%= _('List of Authors')%></div>
  <div class="box_space_body" style="font-size: 10px;">
    <ul style="list-style-position: inside; list-style-type: disc;">
    <% user_archives.each do |archive| -%>
      <% link_text =  archive.user_name + " (" + archive.count + ")" -%>
      <li><%= link_to h(link_text), :archive => "all", :user_id => archive.user_id, :sort_type => h(params[:sort_type]) %></li>
    <% end -%>
    </ul>
    <br style="display: none; clear:left;" />
  </div>
  <div class="box_space_bottom"></div>
</div><!-- box_space -->
