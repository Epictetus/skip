<% tabindex = 0 %>
<% action_value = is_new ? :apply : :update_profile %>
<% form_tag({:action => action_value}, {:id => "registration_form", :class => 'margin10'}) do %>

<%= render(:partial => "system/error_messages_for", :locals => { :messages => @error_msg }) if @error_msg %>

<h2 class="subtitle"><%= _('Account Information')%></h2>
<table class="normal user_info">
  <tr>
    <th><label for="user_name"><%=h s_('Admin::User|Name') %></label></th>
    <td><%=h @user.name %></td>
  </tr>
  <tr>
    <th><label for="user_email"><%=h s_('User|Email') %></label></th>
    <td><%=h @user.email %><span style="margin-left: 20px;"><%= link_to _("[Change]"), :action=> 'manage', :menu => 'manage_email' if !is_new && SkipEmbedded::InitialSettings['mail']['show_mail_function'] %></span></td>
  </tr>
  <tr>
    <th><label for="user_section"><%=h s_('User|Section') %></label></th>
  <% if Admin::Setting.enable_change_section -%>
    <td>
      <% if sections = User.grouped_sections -%>
      <p>
      <%= select("user", "section", sections, {}, {:tabindex => (tabindex += 1)}) + _('Showing options from previously registered values') %>
      </p>
      <% end -%>
      <p>
      <%= text_field_tag("user[section]", (sections.include?(@user.section) ? '' : @user.section), :tabindex => (tabindex += 1), :class=> 'appendable_text') + _('Enter here if you cannot find the value in the options') %>
      </p>
    </td>
  <% else -%>
    <td><%= h @user.section %></td>
  <% end -%>
  </tr>
<% if @user.within_time_limit_of_activation_token? -%>
  <tr>
    <th><label for="user_password"><%= s_('Admin::User|Password') %></label></th>
    <td><%= password_field 'user', 'password', {:tabindex => (tabindex +=1)} %></td>
  </tr>
  <tr>
    <th><label for="user_password_confirmation"><%= s_('Admin::User|Password confirmation') %></label></th>
    <td><%= password_field 'user', 'password_confirmation', {:tabindex => (tabindex +=1)} %></td>
  </tr>
<% end -%>
</table>

<%= render :partial => 'portal/profile_form', :locals => {:user => @user} %>

<% submit_button_value = is_new ? _("Register User") : _("Save") %>
<%= submit_tag submit_button_value, {:tabindex => (tabindex += 1), :id => 'submit_button', :disable_with => _("Saving..."), :class=>"margin05em"} %>
<% end %>
</div>
