<% messages ||= "" %>
<% @title = 'アンテナへの追加' %>

<div id="select_antenna_body">

<div class="desc">このブログ/掲示板をアンテナに追加できます。
<br/>追加するアンテナを選択してください</div>

<% unless messages.empty? %>
  <div class="warning" onclick="this.style.display = 'none';">
    <h3><%=h messages %></h3>
  </div>
<% end %>

<% already_include = false -%>
<div style="margin: 3px;">
<p style="font-size: 10px;">あなたのアンテナ：</p>
<p style="border: 1px solid silver; background-color: #f0f0ff; margin: 0 5px; padding: 0 5px;">
<% antennas.each do |antenna| -%>
  <% if antenna.included -%>
    <% already_include = true -%>
  <% else -%>
    <%= link_to h(antenna.name), {:controller => "antenna", :action => "add_symbol"}, {:id => "add_symbol_link_#{antenna.id}", :class => "add_symbol_link"} %>&nbsp;/
  <% end %>
<% end %></p>
</div>

<% if already_include -%>
<div style="margin: 3px;">
<p style="font-size: 10px;">このユーザは以下のアンテナに既に登録済みです：</p>
<p style="border: 1px solid silver; background-color: #f0f0ff; margin: 0 5px; padding: 0 5px;">
<% antennas.each do |antenna| -%>
  <%= h(antenna.name) + ' /' if antenna.included -%>
<% end %></p>
</div>
<% end -%>

<div style="border: 1px solid silver; background-color: #f0f0ff; margin: 8px; padding: 5px; padding-top: 0; ">
  <% form_tag({ :controller => :antenna, :action => :add_antenna_and_symbol }, { :id => "add_antenna_and_symbol_form" }) do -%>
    新しいアンテナを作成して追加：
    <%= text_field :antenna, :name %>
    <%= hidden_field_tag :symbol, h(symbol) %>
    <%= hidden_field_tag("authenticity_token", form_authenticity_token) %>
    <%= submit_tag "追加" %>
  <% end -%>
</div>

</div>
<script type="text/javascript">
$j(function() {
    $j('.add_symbol_link')
    .click(function() {
        var antennaId = this.id.split('_')[3];
        var symbol = '<%= h(symbol) -%>';
        $j.ajax({
            type: 'POST',
            url: $j(this).attr('href'),
            data: { antenna_id: antennaId, symbol: symbol, authenticity_token: $j('#authenticity_token').val() },
            success: function(html) {
                $j('#select_antenna_body').html(html);
            }
        });
        return false;
    });

    $j('#add_antenna_and_symbol_form')
    .submit(function() {
        $j.ajax({
            type: 'POST',
            url: $j(this).attr('action'),
            data: $j(this).serialize(),
            success: function(html) {
                $j('#select_antenna_body').html(html);
            }
        });
        return false;
    });
});
</script>
