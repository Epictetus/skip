<<<<<<< HEAD:app/views/mypage/index.html.erb
<% content_for :stylesheet do -%>
  <%= skip_stylesheet_link_tag "themes/cupertino/ui.theme.css" %>
  <%= skip_stylesheet_link_tag "themes/cupertino/ui.tabs.css" %>
<% end -%>

<% content_for :contents_left do -%>
  <%= render(:partial => 'user/portrait_box', :locals => { :current_user_info => @current_user_info }) %>
  <%= render :partial => 'short_cut' %>
  <%= render :partial => 'antenna_box', :locals => { :system_antennas => @system_antennas, :my_antennas => @my_antennas } %>
  <%= render :partial => 'collaboration_app/operation_boxes' %>
<% end -%>

<% content_for :contents_right do -%>
  <%# ============================================================ -%>
  <%#  right side area -%>
  <%# ============================================================ -%>
  <div id="mypage_right">
    <div id="calendar">
      <%= render :partial => "shared/calendar", :locals => {:sel_year => @year, :sel_month => @month, :sel_day => @day, :item_count => @entry_count_hash, :action => 'entries_by_date'}  %>
    </div>
    <%= render :partial => 'rss_feed_box' %>
    <%= render :partial => 'recent_group_box', :locals => {:recent_groups => @recent_groups} %>
    <%= render :partial => 'recent_user_box', :locals => {:recent_users => @recent_users} %>
=======

<div id="contents_container">

<div id="contents_left">

  <%= render(:partial => 'user/portrait_box', :locals => { :user => @user }) -%>

  <div id="calendar"><%= render :partial => "shared/calendar", :locals => {:sel_year => @year, :sel_month => @month, :sel_day => @day, :item_count => @entry_count, :action => 'index'}  %></div>

<div class="box_space">
  <div class="box_space_title"><%= _('See in List')%></div>
  <div class="box_space_body"><ul>
    <li><%= icon_tag 'folder_user' -%><%= link_to(_("Recent Questions"), :action => "index", :list_type => "questions", :all => true ) -%></li>
    <li><%= icon_tag 'folder_star' -%><%= link_to(_("Recent Popular Entries"), :action => "index", :list_type => "access_blogs" ) -%></li>
    <li><%= icon_tag 'folder_page' -%><%= link_to(_("Recently Posted Entries"), :action => "index", :list_type => "recent_blogs" ) -%></li>
    <li><%= icon_tag 'folder_feed' -%><%= link_to(_("Unread Entries in Antennas"), :action => "index", :list_type => "not_reading_blogs", :all => true ) -%></li>
  </ul></div>
  <div class="box_space_bottom"><!--【メニューを管理する】--></div>
</div><!-- box_space -->

  <div id="antennas">
<div class="box_space">
  <div class="box_space_title"><%= _('Antennas')%></div>
  <%= skip_image_tag 'indicator.gif' %> <span style="color:gray"><%= _('Loading...')%></span>
</div>
</div>

  <div id="my_infos">
<div class="box_space">
  <div class="box_space_title"><%= _('Your info')%></div>
  <div class="box_space_body"><ul>
    <li><%= icon_tag 'rosette' -%><span id="access_count"><%= dummy_link_to _('Access Count')-%><%= _(": %d") % @my_info[:access_count] -%></span>
      <div id="access_count_help" class="help" style="display:none;"><%= _('(The total number of access to your page by other users)')%></div></li>
    <li><%= icon_tag 'newspaper' -%><span id="subscriber_count"><%= dummy_link_to _('Subscribers') -%><%= _(": %d users") % @my_info[:access_count] -%></span>
      <div id="subscriber_count_help" class="help" style="display:none;"><%= _('(The number of users who are checking your blog with the antenna)')%></div></li>
    <li><%= icon_tag 'report_user' -%><span id="blog_count"><%= dummy_link_to _('Blogs') -%><%= n_(": %d entry", ": %d entries", @my_info[:blog_count]) % @my_info[:blog_count] -%></span>
      <div id="blog_count_help" class="help" style="display:none;"><%= _('(The number of blog entries you posted)')%></div></li>
    <li><%= icon_tag 'user_suit' -%><span id="using_day"><%= dummy_link_to _('Registered') -%><%= _(": %d days") % @my_info[:using_day] -%></span>
      <div id="using_day_help" class="help" style="display:none;"><%= _('(Days since you registered with the site)')%></div></li>
  </ul></div>
  <div class="box_space_bottom"></div>
</div><!-- box_space -->
>>>>>>> for_i18n:app/views/mypage/index.html.erb
  </div>

  <%# ============================================================ -%>
  <%#  main area -%>
  <%# ============================================================ -%>
  <div id="mypage_left">
    <%# ============================================================ -%>
    <%#  main area top messages -%>
    <%# ============================================================ -%>
    <% if (@message_array.size > 0) or (@waiting_groups.size > 0) or (@system_messages.size > 0) -%>
    <div class="top_info system_message">
      <% @system_messages.each do |message| -%>
      <div class="item">
        <%= link_to(icon_tag(message[:icon]) + h(message[:text]), message[:option]) %>
      </div>
      <% end -%>
      <% @message_array.each do |message| -%>
      <div class="item">
        <%= link_to(icon_tag(Message::MESSAGE_TYPES[message[:message_type]][:icon_name]) + h(message[:message]), message[:link_url]) %>
      </div>
      <% end -%>
      <% @waiting_groups.each do |group| -%>
      <div class="item">
        <%= item_link_to(group, {:view_text=>(icon_tag('group') + "[#{h(group.name)}]に承認待ちのユーザがいます！")}) %>
      </div>
      <% end -%>
    </div>
    <% end -%>

    <% if (@important_your_messages.size > 0) %>
    <div class="top_info important_message">
      <% @important_your_messages.each do |entry| %>
        <div class="item"><%= entry_link_to(entry, {:view_text=>get_light_icon(entry) + h(entry.title)}) %></div>
      <% end %>
    </div>
    <% end %>

    <% if @mail_your_messages[:pages].size > 0 %>
      <%= show_title_bar(@mail_your_messages[:title_icon], @mail_your_messages[:title_name], {:controller => 'mypage', :action => "entries_by_antenna", :antenna_id => @mail_your_messages[:id_name]}) %>
      <%= render :partial => "list_block", :locals => @mail_your_messages %>
    <% end %>

    <%# ============================================================ -%>
    <%#  main area entries -%>
    <%# ============================================================ -%>
    <%= show_title_bar(@questions[:title_icon], @questions[:title_name], {:controller => 'mypage', :action => "entries", :list_type => @questions[:id_name]}) -%>
    <%= render :partial => "list_block", :locals => @questions %>

    <%= show_title_bar("page_copy", _("公開された記事"), {:controller => 'search', :action => "entry_search"}) -%>
    <div id="tabs" style="margin: 0 5px 10px 10px; display: none;">
      <ul>
        <li><a href="#<%= @access_blogs[:id_name] %>"><span><%=h @access_blogs[:title_name] %></span></a></li>
        <li><a href="#<%= @recent_blogs[:id_name] %>"><span><%=h @recent_blogs[:title_name] %></span></a></li>
    <% @recent_bbs.each do |bbs| -%>
        <li><a href="#<%= bbs[:id_name] %>"><span><%=h bbs[:title_name] %></span></a></li>
    <% end -%>
      </ul>
      <div id="<%= @access_blogs[:id_name] %>">
        <%= render :partial => "list_block", :locals => @access_blogs %>
      </div>
      <div id="<%= @recent_blogs[:id_name] %>">
        <%= render :partial => "list_block", :locals => @recent_blogs %>
      </div>
    <% @recent_bbs.each do |bbs| -%>
      <div id="<%= bbs[:id_name] %>">
        <%= render :partial => "list_block", :locals => bbs %>
      </div>
    <% end -%>
    </div>

    <%# ============================================================ -%>
    <%#  main area collaboration_apps feeds -%>
    <%# ============================================================ -%>
    <%= render(:partial => 'collaboration_app/feeds') %>

    <%# ============================================================ -%>
    <%#  main area bookmarks -%>
    <%# ============================================================ -%>
    <%= show_title_bar("tag_blue", _("最新のブックマーク"), {:controller => 'bookmarks'}) %>
    <% if @bookmarks.size > 0 %>
      <div class="topix_body" id="bookmark_body">
      <% @bookmarks.each do |bookmark| -%>
        <div class="page_line">
          <div class="page_title"><%= link_to_bookmark_url bookmark %></div>
          <div class="page_from"><%= link_to(bookmark.bookmark_comments_count.to_s+"人", url_for_bookmark(bookmark)) %></div>
          <div class="page_date"><%=h bookmark.updated_on.strftime("%m/%d %H:%M") %></div>
        </div>
      <% end -%>
      </div>
    <% end -%>
  </div>
  <br style="clear: right;"/>
<% end -%>

<% content_for :javascript_initializers do -%>
    $j('#tabs').tabs({ cookie:{ expires:30 } });
    $j('#tabs').show();

    var loadEntries = function(data){
        var id_name = data['target'];
        $j.ajax({
            url: '<%= url_for(:controller => 'mypage', :action => 'load_entries') -%>',
            data: data,
            success: function(html) {
                $j('#' + id_name).html(html).appendClickForToggleTag();
                $j('#' + id_name + '_body').highlight();
            },
            complete: function(request) {
                unbindEentyPageChange();
                setupEntryPageChange();
            }
        });
    };

    var unbindEentyPageChange = function(){
        $j('.first_link').unbind('click');
        $j('.back_link').unbind('click');
        $j('.next_link').unbind('click');
        $j('.last_link').unbind('click');
    };

    var setupEntryPageChange = function(){
        // 最初へ,前へ,次へ,最後へリンククリック時のajaxアクション
        $j('.first_link')
        .click(function() {
            var id_name = this.id.split('-')[0];
            loadEntries(requestData(1, id_name));
            return false;
        });

        $j('.back_link')
        .click(function() {
            var id_name = this.id.split('-')[0];
            var base_id = '#' + id_name + '_body';
            var page = $j('#page_back', base_id).val();
            loadEntries(requestData(page, id_name));
            return false;
        });

        $j('.next_link')
        .click(function() {
            var id_name = this.id.split('-')[0];
            var base_id = '#' + id_name + '_body';
            var page = $j('#page_next', base_id).val();
            loadEntries(requestData(page, id_name));
            return false;
        });

        $j('.last_link')
        .click(function() {
            var id_name = this.id.split('-')[0];
            var base_id = '#' + id_name + '_body';
            var page = $j('#page_last', base_id).val();
            loadEntries(requestData(page, id_name));
            return false;
        });
    };
    setupEntryPageChange();

    var requestData = function(page, id_name){
        var base_id = '#' + id_name + '_body';
        var per_page = $j('#per_page', base_id).val();
        var recent_day = $j('#recent_day', base_id).val();
        return { page : page, page_name : 'list_block', target : id_name, per_page : per_page, recent_day : recent_day };
    };

    setupLoadCalendar("<%= url_for(:action => 'load_calendar') %>");
<% end -%>
